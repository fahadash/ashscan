using System;
using System.Collections.Generic;
using System.Linq;
using System.Net;
using System.Net.Sockets;
using System.Text;
using System.Threading.Tasks;

namespace ExploitChecker
{
    public class BarracudaExploitChecker : IPAddressExploitChecker
    {
        public BarracudaExploitChecker()
            : base()
        {
        }

        protected override string FormatAddress(byte[] addressBytes)
        {
            return string.Format
            (
                "{0}.{1}.{2}.{3}.ban.barracudacentral.org",
                Convert.ToInt32(addressBytes[3]),
                Convert.ToInt32(addressBytes[2]),
                Convert.ToInt32(addressBytes[1]),
                Convert.ToInt32(addressBytes[0])
            );
        }

        protected override IEnumerable<ExploitType> CheckHostAddresses(IPAddress[] hostAddresses)
        {
            return hostAddresses
                    .Select(x => Convert.ToInt32(x.GetAddressBytes()[3]))
                    .Where(x => x == 2)
                    .Select(x => ExploitType.Barracuda_Blacklisted);
        }
    }
}