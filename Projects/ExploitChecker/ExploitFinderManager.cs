namespace ExploitFinder
{
    using System.Collections.Generic;
    using System.Linq;

    using ExploitChecker;

    using global::ExploitFinder.ExtensionNodes;

    using Mono.Addins;

    public class ExploitFinderManager
    {
      
        static ExploitFinderManager()
        {

            AddinManager.Initialize();
            AddinManager.Registry.Update();
            AddinManager.AddinLoadError +=AddinManager_AddinLoadError;

        }

        private static void AddinManager_AddinLoadError(object sender, AddinErrorEventArgs args)
        {
           
        }

        public IEnumerable<IHostExploitFinder> GetHostExploitFinders()
        {
            var finders =
                AddinManager.GetExtensionNodes<DnsBlacklistProviderNode>("/ExploitFinder/HostExploitFinder")
                    .Select(
                        e =>
                        new DnsExploitFinder()
                            {
                                ProviderName = e.ProviderName,
                                HostSuffix = e.HostSuffix,
                                ExploitDictionary =
                                    e.ChildNodes
                                    .OfType<ExploitCodeNode>()
                                    .ToDictionary(c => c.Code, c => c.GetExploit())
                            });

            return finders.ToArray();

        }


    }
}
